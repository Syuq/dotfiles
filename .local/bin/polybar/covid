#!/bin/bash

# Set country by running this command `covid country_name`
country="$1"
# Default country is Vietnam if it's not set
[ -z "$country" ] && country="Vietnam"

# Get information about Covid-19 in $country
info="$(curl -s https://corona.lmao.ninja/v2/countries/ |
    awk -F'},{' '{ for (i = 1; i < 230; ++i) print $i; }' |
    grep -i "$country" | awk -F',' '{ for (i = 1; i < 30; ++i) print $i;}')"

array=($info)
for i in "${!array[@]}"; do
    [[ "${array[i]}" == *'"cases":'* ]]             && confirmed="${array[i]#*:}"
    [[ "${array[i]}" == *'"todayCases":'* ]]        && inc_confirmed="${array[i]#*:}"
    [[ "${array[i]}" == *'"deaths":'* ]]            && deaths="${array[i]#*:}"
    [[ "${array[i]}" == *'"todayDeaths":'* ]]       && inc_deaths="${array[i]#*:}"
    [[ "${array[i]}" == *'"recovered":'* ]]         && recovered="${array[i]#*:}"
    [[ "${array[i]}" == *'"todayRecovered":'* ]]    && inc_recovered="${array[i]#*:}"
done

output="ðŸ˜· $confirmed(+$inc_confirmed), ðŸ’€ $deaths(+$inc_deaths), ðŸ˜€ $recovered(+$inc_recovered)"

# If $confirmed is empty, print out covid.log
[ -z "$confirmed" ] && cat /tmp/covid.log 2&> /dev/null && exit

printf "$output" > /tmp/covid.log
printf "$output"

exit 0
